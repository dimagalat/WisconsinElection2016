---
title: "Analysis of the 2016 Wisconsin vote"
author: "Sean Case"
date: "15 November 2016"
output:
  html_document: default
  pdf_document: default
  word_document:
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

require(ggplot2); library(plotly);require(devtools); library(XML); require(rvest); require(stringr);require(xlsx);require(dplyr);require(plyr)
require(agricolae); require(ggplot2); library(gridExtra); library(tidyr)

# I got this from here: http://stackoverflow.com/questions/31337922/adding-italicised-r-with-correlation-coefficient-to-a-scatter-plot-chart-in-ggpl
corr_eqn <- function(x,y, digits = 2) {
  corr_coef <- round(cor(x, y), digits = digits)
  paste("italic(r) == ", corr_coef)
}

default.margin = list(l = 100, r = 80, b = 80, t = 20, pad = 4)
colours = c("grey", "lightcoral", "dark grey", "light blue", "light green","grey","grey")

library(plotly)
py <- plot_ly(username="SeanCase", key="••••••••••")

setwd("C:\\Users\\s_cas\\Dropbox\\Perso\\2016 voting election county results\\Wisconsin")

candidate.2016.summary = read.csv("candidate.2016.summary.csv")
counties.2016.bycand = read.csv("counties.2016.bycand.csv")
county.2016.vs.2012 = read.csv("county.2016.vs.2012.csv")
counties.2000.2016 = read.csv("counties.2000.2016.csv")
elections.100.years = read.csv("elections.100.years.csv")
all_polls_2012 = read.csv("all_polls_2012.csv")
all_polls_2016 = read.csv("all_polls_2016.csv")
selected_polls_2012.sub = read.csv("selected_polls_2012.sub.csv")
selected_polls_2016.sub = read.csv("selected_polls_2016.sub.csv")

elections.100.years.summary.2016 = subset(elections.100.years, year == 2016)
elections.100.years.postwar = subset(elections.100.years, year >= 1948)

## Comparing the definite poll voters with the final result
poll.summary.2016 = data.frame(c(1:4))
poll.summary.2016$cand.group = c("Donald J. Trump", "Hillary Clinton", "Other","Undecided")
poll.summary.2016$polls.nov = with(selected_polls_2016.sub,
                                   c(mean(trump),mean(clinton),mean(other),mean(undecided,na.rm=T)))
poll.summary.2016$c.1.4. = NULL
poll.summary.2016$polls.nov.def = with(elections.100.years.summary.2016, c(mean.rep.poll.oneweek.defs, mean.dem.poll.oneweek.defs, mean.oth.poll.oneweek.defs,NA))

candidate.2016.summary$polls.nov = with(poll.summary.2016, c(polls.nov[1], polls.nov[2], rep(polls.nov[3],5)))
candidate.2016.summary$polls.nov.def = with(poll.summary.2016, c(polls.nov.def[1], polls.nov.def[2], rep(polls.nov.def[3],5)))

candidate.2016.summary$diff.from.poll = candidate.2016.summary$votes.perc.group - candidate.2016.summary$polls.nov
candidate.2016.summary$diff.from.poll.defs = candidate.2016.summary$votes.perc.group - candidate.2016.summary$polls.nov.def


### 2012 results ###
elections.100.years.summary.2012 = elections.100.years.postwar[2,]

poll.summary.2012 = data.frame(c(1:4))
poll.summary.2012$cand.group = c("Mitt Romney", "Barack Obama", "Other","Undecided")
poll.summary.2012$polls.nov = with(selected_polls_2012.sub,
                                   c(mean(romney),mean(obama),mean(other,na.rm=T),mean(undecided,na.rm=T)))
poll.summary.2012$c.1.4. = NULL
poll.summary.2012$polls.nov.def = with(elections.100.years.summary.2012, c(mean.rep.poll.oneweek.defs, mean.dem.poll.oneweek.defs, mean.oth.poll.oneweek.defs,NA))

poll.summary.2012$vote = with(elections.100.years.summary.2012, c(rep.vote, dem.vote, oth.vote,NA))
poll.summary.2012$vote.perc = with(elections.100.years.summary.2012, c(rep.vote.perc, dem.vote.perc, oth.vote.perc,NA))

poll.summary.2012$diff.from.polls = with(poll.summary.2012, vote.perc - polls.nov)
poll.summary.2012$diff.from.polls.defs = with(poll.summary.2012, vote.perc - polls.nov.def)

poll.summary.2012.nounds = poll.summary.2012[1:3,]
## VISUALISING THE 2016 RESULTS
county.summary.2016.final = subset(counties.2000.2016, year == 2016)
county.2016.vs.2012 = county.2016.vs.2012[order(county.2016.vs.2012$county), ]
added.columns = county.summary.2016.final[,20:28]
county.2016.vs.2012 = cbind(county.2016.vs.2012, added.columns)

county.2016.vs.2012$total.voting.age= as.integer(county.2016.vs.2012$total.voters.age.est)
county.2016.vs.2012.2000ppl = subset(county.2016.vs.2012, turnout > 2000)

county.2016.vs.2012.2000ppl.mildane= subset(county.2016.vs.2012.2000ppl, county != "Milwaukee" & county != "Dane")


county.summary.2016.final$mostly.dem.num = ifelse(county.summary.2016.final$mostly.dem == "Mostly Dem",1,0)
county.summary.2016.final$dem.other.change = county.summary.2016.final$dem.change - county.summary.2016.final$oth.change

county.summary.2016.final.highpop = subset(county.summary.2016.final, total.voting.age > mean(total.voting.age))
county.summary.2016.final$total.voting.age= as.integer(county.summary.2016.final$total.voting.age)
county.summary.2016.final.2000ppl= subset(county.summary.2016.final, turnout > 2000)

county.summary.2016.final.2000ppl.mildane= subset(county.summary.2016.final.2000ppl, county != "Milwaukee" & county != "Dane")

counties.2000.2016.2000ppl= subset(counties.2000.2016, turnout > 2000)

counties.2000.2016.2000ppl.mildane = subset(counties.2000.2016.2000ppl, county != "Milwaukee" & county != "Dane")

```
# Introduction
The 2016 Presidential election surprised many with unexpected results in many states that ran counter to the polls, and counter to recent trends in these states. Specifically, the previously-thought 'safe' states of Wisconsin, Michigan, and Pennsylvania switched from Democrat to Republican, and were key to clinching the victory for Trump.

Concern has surfaced by those close to the events of election night, specifically that the USA was under attack from hackers during November 8. Some feared that hacking may have had some influence on the election, especially in areas where voting machines are in use. Since the result in Wisconsin was so close, and the result so unexpected (at least judging by the polls close to election day), I decided to use my R skills to try to look deeper into the Wisconsin results. 

Were the results really so unexpected? Did the results deviate significantly from the polling, or from previous elections? Did the presence of voting machines in polling stations affect the result in any way?

# State level analysis
## In Wisconsin, the results did not deviate greatly from the national vote

Nationally, 47.2% voted for Trump vs 47.9% for Clinton nationally, leaving other candidates with 4.9% (uselectionatlas.org). In Wisconsin (with 95% votes counted at time of writing), Donald Trump won with 47.9% of the vote compared to the 46.9% of Clinton, a difference of only ~27,000 votes. The majority of 'other' voters went for Gary Johnson (3.6 of the 5.1% who voted 'other' in Wisconsin), and Jill Stein received just over 1%, both close to their national averages. 

So far, nothing strange. 

## The polls were off, but slightly

I downloaded the data from the 2016 polls in Wisconsin for 2016 from the HuffPost Pollster API, and subset it to looking only at polls started 7 days before the election or later. Focusing on decided voters only, Clinton underperformed on election day (2.7% lower than poll expectations), Trump overperformed (+2.1%), while 'Others' slightly overperformed (+0.6%). This means that more of the 'undecideds' went to Trump, or that many potential Clinton supporters chose not to turn up.

```{r 2016resultsvspolls, echo=FALSE, fig.cap= "Percentage votes for the candidates.Lines indicate polling of decided voters,excluding those who were unsure."}

candidate.2016.summary.vis.defs = ggplot(candidate.2016.summary,
                                            aes(x = ordered.cands, y = votes.perc, fill = cand,group=1)) +
  geom_bar(stat = "identity") +
  geom_line(stat = "identity",
            aes(y = elections.100.years.summary.2016$mean.dem.poll.oneweek.defs),
            colour = "blue", linetype = 2,
            show.legend = F) +
  geom_line(stat = "identity",
            aes(y = elections.100.years.summary.2016$mean.rep.poll.oneweek.defs),
            colour = "red", linetype = 2,
            show.legend = F) +
  geom_line(stat = "identity",
            aes(y = elections.100.years.summary.2016$mean.oth.poll.oneweek.defs),
            colour = "black", linetype = 2,
            show.legend = F) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  scale_y_continuous(
    name =
      "Bars: Votes for the candidates (%). Lines: polling of decided voters (%)."
  ) +
  scale_x_discrete(
    limit =  candidate.2016.summary$ordered.cands,
    labels = as.character(candidate.2016.summary$cand),
    name = NULL) +
  scale_fill_manual(values = colours)
candidate.2016.summary.vis.defs

# ggplotly(candidate.2016.summary.vis.defs, session = "knitr", width = 800, height = 600) %>% 
#   layout(bargap = 3, autosize=T, margin = default.margin) # l, r, b, t, pad

```

Were the polls particularly innaccurate in Wisconsin in 2016? I compared these polls with those from 2012, focusing again on polls started 7 days before election day. The polls show that deviations from the polling expectations were also close to 3%. So the deviations we see in 2016 are nothing out of line.

```{r resultsvspolls2012and2016, echo=FALSE, fig.cap="The % difference between definite voter polls and the final result of the 2016 presidential election"}
candidate.2016.summary.small = subset(candidate.2016.summary, votes.rec > 100000)

poll.2016.compare.vis.defs = ggplot(candidate.2016.summary.small, aes(x = cand.group, y = diff.from.poll.defs, fill = cand.group, group = 1)) +
  # geom_line(stat = "identity",show.legend = F, aes(y = elections.100.years.summary.2016$polls.nov)) +
  geom_bar(stat = "identity", show.legend = F) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  coord_cartesian(ylim = c(-5,5)) +
  scale_y_continuous(
    name =
      "Deviance between polls and election outcomes (%)."
  ) +
  scale_x_discrete(
    limit =  candidate.2016.summary.small$cand.group,
    labels = as.character(candidate.2016.summary.small$cand.group),
    name = NULL) +
  scale_fill_manual(values = c("lightcoral","light blue","dark grey"))
# poll.2016.compare.vis.defs

poll.2012.compare.vis.defs = ggplot(poll.summary.2012.nounds, aes(x = cand.group, y = diff.from.polls.defs, fill = cand.group, group = 1)) +
  # geom_line(stat = "identity",show.legend = F, aes(y = elections.100.years.summary.2016$polls.nov)) +
  geom_bar(stat = "identity", show.legend = F) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  coord_cartesian(ylim = c(-5,5)) +
  scale_y_continuous(
    name =
      "Same for 2012."
  ) +
  scale_x_discrete(
    limit =  poll.summary.2012.nounds$cand.group,
    labels = as.character(poll.summary.2012.nounds$cand.group),
    name = NULL) +
  scale_fill_manual(values = c("light blue","lightcoral","dark grey"))
# poll.2012.compare.vis.defs

compare.2016.2012.polls.plotnames = c("poll.2016.compare.vis.defs",
                                      "poll.2012.compare.vis.defs")
compare.2016.2012.polls = marrangeGrob(
  grobs = mget(compare.2016.2012.polls.plotnames),
  nrow = 1,
  ncol = 2,
  top = NULL
)
compare.2016.2012.polls
```

## Was Wisconsin 2016 a strange compared to historical trends?

```{r historical.dems.vs.turnout, echo=FALSE, fig.cap="Democrat and other votes with time (%). Grey bars indicate other votes. Line indicates % turnout."}

# Change in Dem votes compared to last election with turnout swing line
historical.election.data.dem.votes = ggplot(elections.100.years.postwar,
                                  aes(
                                    x = year,
                                    y = dem.vote.perc,
                                    fill = winner,
                                    group = 1
                                  )) +
  geom_bar(stat = "identity") +
  geom_line(
    aes(y = elections.100.years.postwar$turnout.perc),
    alpha = 0.5,
    stat = "identity",
    colour = "black"
  ) +
  geom_bar(stat = "identity",fill = "grey", show.legend = FALSE, width = 2,
           aes(y = oth.vote.perc)
           ) +
  scale_y_continuous(
    name = "Bars: election votes (%). Line: turnout (%)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_continuous(breaks = seq(1948,2016,4)) +
  scale_fill_manual(values = c("light blue", "lightcoral"))
historical.election.data.dem.votes

  # ggplotly(historical.election.data.dem.votes, session = "knitr", width = 800, height = 600) %>%
  # layout(bargap = 3, autosize=T, margin = default.margin) # l, r, b, t, pad
  
  # Here's what we can do with the layout function: https://plot.ly/r/reference/#Layout_and_layout_style_objects
```

Comparing the 2016 election to those back to 1948, it does not appear that the votes for the Democrats, or turnout, differed significantly from historical trends. The 'other' vote percentage is noticeable, as it is the highest recorded since 1948; However, we have previously noted that this percentage matched the national average.

One other thing to note is that Wisconsin has voted Democrat since 1988, making 2016 the year to break a 7-election trend. Unusual, but nowhere near enough to note anything suspicious.

One other factor we can consider with this data is the % swing in votes or turnout from one election to the next.
```{r swing.historic, echo=FALSE, fig.cap="Swing vote percentage from previous election with time. The line indicates change in % turnout compared with previous election"}
historical.election.data.swing = ggplot(elections.100.years.postwar,
                                  aes(
                                    x = year,
                                    y = swing.vote.perc,
                                    fill = winner,
                                    group = 1
                                  )) +
  geom_bar(stat = "identity") +
  geom_line(
    aes(y = elections.100.years.postwar$swing.turnout.perc),
    alpha = 0.5,
    stat = "identity",
    colour = "black"
  ) +
  scale_y_continuous(
    name =
      "Bars: vote swing (%), Lines: change in turnout (%)"
    ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  annotate(
    "text",
    x = mean(elections.100.years.postwar$year),
    y = min(elections.100.years.postwar$swing.vote.perc),
    label = "Vote swing towards Democrats",
    vjust = 1,
    hjust = 0.5
  ) +
  annotate(
    "text",
    x = mean(elections.100.years.postwar$year),
    y = max(elections.100.years.postwar$swing.vote.perc),
    label = "Vote swing towards Republicans",
    vjust = 1,
    hjust = 0.5
  ) +
  scale_fill_manual(values = c("light blue","lightcoral"))
historical.election.data.swing
```
This figure shows that although there was a significant vote swing from Democrats to Republican (~8%), the magnitude of this swing was not large in historical terms. Overall turnout was down by ~3% compared to the previous election.

So far, nothing suspicious. We need to go deeper into the data, so now we go to the county level.

# County level vote analysis

The Wisconsin Elections Commission website (http://elections.wi.gov/) provides county-level voting results back to 2000, as well as additional data about voter population and the municipalities that use voting machines. This data was used for the following analysis.

```{r counties clinton vote turnout, echo=F, fig.cap="Percentage vote for Clinton in Wisconsin counties. Grey bar behind indicates percentage turnout"}
county.2016.vs.2012 = county.2016.vs.2012[order(county.2016.vs.2012$dem.votes.perc), ]
county.2016.vs.2012$ordered.county.2016.dem.votes.perc = c(1:length(county.2016.vs.2012$dem.votes.perc))

# Visualising votes for clinton by county and by turnout. Turnout does not seem to differ drastically according to
# Republican won or Clinton won county
county.perc.winner = ggplot(
  county.2016.vs.2012,
  aes(
    x = county.2016.vs.2012$ordered.county.2016.dem.votes.perc,
    y = dem.votes.perc,
    fill = winner
  )) +
  geom_bar(
    aes(y = county.2016.vs.2012$turnout.perc.allage.est ),
    stat = "identity",
    fill = "grey"
  ) +
  geom_bar(stat = "identity", alpha = 0.6) +
  scale_y_continuous(name =
  paste("Blue/red bars: percentage vote Democrats, filled by winner (%).\nGrey bar: voter turnout (%)")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4)) +
  scale_x_discrete(
    limit =  county.2016.vs.2012$ordered.county.2016.dem.votes.perc,
    labels = as.character(county.2016.vs.2012$county),
    name = NULL
  ) +
  scale_fill_manual(values = c("light blue", "lightcoral"))
county.perc.winner
```

This figure shows us that 1. there were a lot less counties won by Clinton than Trump, and 2. the counties won by Clinton did not necessarily have a lower turnout.

We can confirm this with a point graph. The following shows that the Clinton vote did not drop with turnout percentage in each county.

```{r clinton v turnout, echo=F, fig.cap="Percentage vote for Clinton in Wisconsin counties against turnout in county."}
county.perc.turnout.dems = ggplot(
  county.2016.vs.2012.2000ppl,
  aes(
    y = dem.votes.perc,
    x = turnout.perc.allage.est,
    colour = winner
  )
) +
  geom_smooth(colour = "grey") +
  geom_point() +
  scale_y_continuous(name = "Percentage vote for Democrats (%)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_continuous(name = "Percentage turnout (%)") +
  # facet_wrap(~mostly.dem, ncol = 1, nrow = 2) +
  scale_fill_manual(values = c("light blue","lightcoral"))
# county.perc.turnout.dems
ggplotly(county.perc.turnout.dems, session = "knitr")

```

The following figures confirm that for many counties, the vote swung significantly from Democrat to Republican. However, there is no single county that stands out in terms of an unusual switch from Democrat to Republican between 2012 and 2016. Also, the turnout does not seem to be related to the % switch from Democrat to Republican.

```{r swing 2012, echo = F, fig.cap="Percentage vote difference in 2012 and 2016 by county.Grey bars are 2012 results,\nred bars are overlaid 2016 results. Negative = Democrat win, positive = Republican win"}

# Visualising county data 2012 vs 2016
  county.2016.vs.2012 = county.2016.vs.2012[order(county.2016.vs.2012$diff.2012.perc), ]
  county.2016.vs.2012$ordered.county.2012.perc.diff = c(1:length(county.2016.vs.2012$diff.2012.perc))

county.2012v2016.perc.diff.2016ord = ggplot(county.2016.vs.2012,
                                            aes(x = ordered.county.2012.perc.diff, y = diff.2012.perc)) +
  geom_bar(stat = "identity") + geom_bar(
    stat = "identity",
    aes(y = county.2016.vs.2012$perc.diff),
    fill = "red",
    alpha = 0.5
  ) +
  scale_y_continuous(
    name = "Vote difference in 2012 and 2016 by county (%), negative = Democrat, positive = Republican ") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4)) +
  scale_x_discrete(
    limit =  county.2016.vs.2012$ordered.county.2012.perc.diff,
    labels = as.character(county.2016.vs.2012$county),
    name = NULL
  ) +
  scale_fill_manual(values = c("light blue", "lightcoral"))
county.2012v2016.perc.diff.2016ord

```

```{r swing2012to2016demtorepublican, echo = F, fig.cap= "Swing percentage between 2012 and 2016 by county. Blue/red bars indicate percentage swing, below 0 = swing to Democrat, above 0 = swing to Republican. Grey bars are percentage swing in turnout."}

# Visualising the swing in votes
county.summary.2016.final = county.summary.2016.final[order(county.summary.2016.final$swing.perc), ]
county.summary.2016.final$ordered.county.swing.perc = c(1:length(county.summary.2016.final$swing.perc))

# Percentage vote change
county.2012v2016.swing.perc = ggplot(county.summary.2016.final,
                                     aes(x = ordered.county.swing.perc, y = swing.perc, fill = winner)) +
  geom_bar(stat = "identity") + geom_bar(stat = "identity",
                                         aes(y = (
                                           county.summary.2016.final$swing.turnout.perc
                                         )),
                                         fill = "grey",
                                         width = 0.4) +
  scale_y_continuous(
    name = "Difference in vote between Democrats and Republicans (2016)") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4)) +
  scale_x_discrete(
    limit =  county.summary.2016.final$ordered.county.swing.perc,
    labels = as.character(county.summary.2016.final$county),
    name = NULL
  ) +
  scale_fill_manual(values = c("light blue", "lightcoral"))
county.2012v2016.swing.perc

```

The following figure shows that there was not a strong correlation between percentage change in turnout between 2012 and 2016 and the counties that have mostly chosen Democrat or Republican in the last five elections.


```{r turnout Dem Rep, echo = F, fig.cap="Swing in turnout between 2012 and 2016 by county and by whether the county has mostly chosen Democrat or Republican in the last five Presidential elections (%)."}
county.summary.2016.final = county.summary.2016.final[order(county.summary.2016.final$swing.turnout.perc), ]
county.summary.2016.final$ordered.turnout.diff = c(1:length(county.summary.2016.final$swing.turnout.perc))

turnout.diff.perc.graph = ggplot(county.summary.2016.final,
                                 aes(x = ordered.turnout.diff, y = swing.turnout.perc,
                                     fill = mostly.dem)) +
  geom_bar(stat = "identity") +
  scale_y_continuous(name = "Swing in turnout between 2012 and 2016 (%).") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 4)) +
  scale_x_discrete(
    limit =  county.summary.2016.final$ordered.turnout.diff,
    labels = as.character(county.summary.2016.final$county),
    name = NULL
  ) +
  scale_fill_manual(values = c("light blue", "lightcoral"))
turnout.diff.perc.graph

```

(Note: some of the following graphs have been subset to remove outlier counties with a turnout of less than 2000, as they were greatly skewing the outputs when considering % change in vote)

How about the swing away from Democrat, and the swing to 'other'? Was this at all unusual? The following shows that these factors were not well correlated with the change in turnout

```{r democrat vote change by turnout, echo=F, fig.cap="Change between 2012 and 2016 in percentage voting Democrat by change in county turnout (%). Colours indicate counties that have mostly chosen Democrat or Republican in 2000 - 2016. Line indicates linear fitted mean, and 'r' indicates the correlation between these variables."}
  county.2012v2016.change.dem.perc.point = ggplot(county.summary.2016.final.2000ppl,
                                                  aes(x = swing.turnout.perc, y = dem.change, colour = winner)) +
    geom_smooth(alpha = 0.5, colour = "grey", method = "lm", se = F) +
    geom_point(stat = "identity") +
    scale_y_continuous(
      name = "Change in vote for Democrats 2012 - 2016 (%)"
    ) +
    scale_x_continuous(
      name = "Change in turnout 2012 - 2016 (%)"
    ) +
    geom_text(x = -8, y = 2,
              label = corr_eqn(county.summary.2016.final.2000ppl$swing.turnout.perc,
                               county.summary.2016.final.2000ppl$dem.change), parse = TRUE,
              show.legend = F, colour = "black") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    scale_colour_manual(values = c("light blue", "lightcoral"))
  county.2012v2016.change.dem.perc.point
```


```{r other vote by turnout, echo=F, fig.cap="Change between 2012 and 2016 in percentage voting other by change in county turnout (%). Colours indicate counties that have mostly chosen Democrat or Republican in 2000 - 2016. Line indicates linear fitted mean, and 'r' indicates the correlation between these variables."}
county.2012v2016.change.oth.perc.point = ggplot(county.summary.2016.final.2000ppl,
                                                aes(x = swing.turnout.perc, y = oth.change, colour = winner)) +
  geom_smooth(alpha = 0.5, colour = "grey", method = "lm", se = F) +
  geom_point(stat = "identity") +
  scale_y_continuous(
    name = "Change in vote for other 2012 - 2016 (%)"
  ) +
    scale_x_continuous(
      name = "Change in turnout 2012 - 2016 (%)"
    ) +
  geom_text(x = -8, y = 5,
            label = corr_eqn(county.summary.2016.final.2000ppl$swing.turnout.perc,
                              county.summary.2016.final.2000ppl$oth.change), parse = TRUE,
            show.legend = F, colour = "black") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_colour_manual(values = c("light blue", "lightcoral"))
county.2012v2016.change.oth.perc.point


```

Finally, we do see a correlation between the change in county votes for Democrat and other (0.5). This figure suggests that the counties that rejected the Democrats most were more likely to vote for Trump rather than another candidate, while those with a small reduction in Democrat votes were more likely to vote other.

```{r dem.change vs oth.change correlation, echo = F}
  county.2012v2016.change.oth.dem.point = ggplot(county.summary.2016.final.2000ppl,
                                                 aes(x = dem.change, y = oth.change, colour = winner)) +
    geom_smooth(alpha = 0.5, colour = "grey", method = "lm", se = F) +
    geom_point(stat = "identity") +
    scale_y_continuous(
      name = "Change in voting other from 2012 (%)."
    ) +
    scale_x_continuous(
      name = "Change in Democrat from 2012 - 2016 (%)"
    ) +
    geom_text(x = 0, y = 5,
              label = corr_eqn(county.summary.2016.final.2000ppl$dem.change,
                               county.summary.2016.final.2000ppl$oth.change), parse = TRUE,
              show.legend = F, colour = "black") +
    theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
    scale_colour_manual(values = c("light blue", "lightcoral"))
  county.2012v2016.change.oth.dem.point

```

The above results can be summarised in a correlation matrix (see below).

```{r correlation.table, echo=F, fig.height=10, fig.width=10}
corr.table = with(county.summary.2016.final.2000ppl, data.frame(dem.change, rep.change,
                                                  oth.change,swing.turnout.perc,log(turnout),
                                                  use.machines.prop,dem.wins))
correlationmatrix = cor(corr.table, use = "pairwise.complete.obs")
corrplot.all = corrplot(correlationmatrix, method = "number", type = "upper")
# corrplot.all
```
Unfortunately, the above correlation matrix cannot help us to understand the influence of voting machines alone on change in Democrat or Republican votes, as it is highly correlated with the voting age population. This suggests that voting machines are mostly installed in high-population counties, and these counties are more likely to vote Democrat. 

It is very difficult to untangle these effects, and so it is not worth looking further in this direction.

However, if we look at 'change in other', we can see that it is quite highly correlated with the increase in voting machines, but is not correlated with the change in turnout, thethe number of people voting in the county, or the number of previous elections won by Democrats. Therefore, it appears that votes for 'other' candidates did not depend on county population, the historical party preference of the county, or lack of voters coming to the polls. 

However, the turnout variable contains a couple of large outliers (Milwaukee and Dane counties have very big turnouts compared to the rest), so it is worth transforming the 'turnout' variable to try to account for this.

```{r correlation}
corr.table.log = with(county.summary.2016.final.2000ppl, data.frame(dem.change, rep.change,
                                                  oth.change,swing.turnout.perc,log(turnout),
                                                  use.machines.prop,dem.wins))
correlationmatrix.log = cor(corr.table.log, use = "pairwise.complete.obs")
corrplot.all.log = corrplot(correlationmatrix, method = "number", type = "upper")
```

Now we can see that the change in vote for other between 2012 and 2016 is highly correlated with the log of the turnout. So, we are back to step 1. Since the results are not consistent when using the original turnout numbers or the logged turnout numbers, we cannot conclude that the other vote change was linked to voting machines, and not just overall turnout.

Still, it is worth confirming this output with a couple more figures. 

## Analysing county results 2000 - 2016 vs voting machine presence in 2016

The following show the change in other vote with time according to the use of machines or the by the previous voting record of the county (Democrat or Repulican). What we can see is that although the vote for 'other' is generally higher in 2016, and for counties that use voting machines, this is the same whether the county normally votes Democrat or Republican.

```{r correlationgraph machines other vote, echo = F, fig.cap="Other vote by use of voting machines in county (%), and the counties that have chosen mostly Democrat or Republican since 2000. Points are individual county results, lines are a mean of the counties in each category."}
historical.oth.vote.perc.graph = ggplot(counties.2000.2016.2000ppl,
                                        aes(x = year, y = oth.vote.perc, colour = all.machines,
                                            group = all.machines)) +
  geom_jitter(alpha = 0.6, width = 0.2) +
  geom_smooth(size = 2) +
  scale_y_continuous(name = "Other vote by use of voting machines in county (%)") +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5), legend.title = element_blank()) +
  scale_x_continuous(breaks = c(seq(2000,2016,4))) +
  scale_colour_manual(values = c("light blue","lightcoral"))  +
  facet_wrap(~mostly.dem)
historical.oth.vote.perc.graph
```

```{r correlationgraph machines other change, echo = F, fig.cap="Change in other vote (%) by use of voting machines in county (%), and the counties that have chosen mostly Democrat or Republican since 2000. Points are individual county results, lines are a mean of the counties in each category."}
historical.oth.vote.perc.change.graph = ggplot(counties.2000.2016.2000ppl,
                                        aes(x = year, y = oth.change, colour = all.machines,
                                            group = all.machines)) +
  geom_jitter(alpha = 0.6, width = 0.2) +
  geom_smooth() +
  scale_y_continuous(name = "Change in other vote from previous election by county (%)") +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5), legend.title = element_blank()) +
  scale_x_continuous(breaks = c(seq(2000,2016,4))) +
  scale_colour_manual(values = c("light blue","lightcoral"))  +
  facet_wrap(~mostly.dem)
historical.oth.vote.perc.change.graph
```

```{r correlationgraph machines other numbers, echo = F, fig.cap="Change in other vote (number of people) by use of voting machines in county (%), and the counties that have chosen mostly Democrat or Republican since 2000. Points are individual county results, lines are a mean of the counties in each category. The error bars are particularly large here because of Milwaukee and Dane counties."}

historical.oth.vote.graph = ggplot(counties.2000.2016.2000ppl,
                                   aes(x = year, y = oth.vote, colour = all.machines,
                                       group = all.machines)) +
  geom_jitter(alpha = 0.6, width = 0.2) +
  geom_smooth() +
  scale_y_continuous(name = "Number of other voters by county (%)") +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5), legend.title = element_blank()) +
  scale_x_continuous(breaks = c(seq(2000,2016,4))) +
  scale_colour_manual(values = c("light blue","lightcoral"))  +
  facet_wrap(~mostly.dem)
historical.oth.vote.graph

```

# Conclusion

In general, the Wisconsin 2016 elections fell within historical ranges in terms of turnout, votes for Democrat and Republican party, and swing from Democrat to Republican. This election does stand out in terms of the increased votes for other parties compared to previous contests. The votes for Wisconsin 'other' parties matched closely the national averages.

I checked the results of the Wisconsin election at the county level to see if there was anything unusual. Changes in voting patterns in 2016 could not be attributed to historical county loyalty to one party or another, or a drop in turnout that affected one party more than another. Turnout number, a proxy for county population (and the urban-rural divide), was highly linked to votes for one party over another, which was also linked to the number of voting machines used in the county. With the data available, it was not possible to separate the effects of turnout number and voting machines.
